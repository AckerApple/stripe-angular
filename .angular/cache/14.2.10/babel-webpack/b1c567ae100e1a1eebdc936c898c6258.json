{"ast":null,"code":"import * as i0 from '@angular/core';\nimport { InjectionToken, Injectable, Inject, EventEmitter, Component, Output, Input, ElementRef, NgModule } from '@angular/core';\nimport * as i1 from '@angular/common';\nimport { DOCUMENT, CommonModule } from '@angular/common';\nimport * as ɵngcc0 from '@angular/core';\nimport * as ɵngcc1 from '@angular/common';\n\nfunction StripeSource_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    ɵngcc0.ɵɵelementContainerStart(0);\n    ɵngcc0.ɵɵelementStart(1, \"div\", 1);\n    ɵngcc0.ɵɵtext(2, \"Stripe PublishableKey NOT SET. Use method StripeScriptTag.setPublishableKey()\");\n    ɵngcc0.ɵɵelementEnd();\n    ɵngcc0.ɵɵelementContainerEnd();\n  }\n}\n\nfunction StripeCard_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    ɵngcc0.ɵɵelementContainerStart(0);\n    ɵngcc0.ɵɵelementStart(1, \"div\", 1);\n    ɵngcc0.ɵɵtext(2, \"Stripe PublishableKey NOT SET. Use method StripeScriptTag.setPublishableKey()\");\n    ɵngcc0.ɵɵelementEnd();\n    ɵngcc0.ɵɵelementContainerEnd();\n  }\n}\n\nfunction StripeBank_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    ɵngcc0.ɵɵelementContainerStart(0);\n    ɵngcc0.ɵɵelementStart(1, \"div\", 1);\n    ɵngcc0.ɵɵtext(2, \"Stripe PublishableKey NOT SET. Use method StripeScriptTag.setPublishableKey()\");\n    ɵngcc0.ɵɵelementEnd();\n    ɵngcc0.ɵɵelementContainerEnd();\n  }\n}\n\nconst STRIPE_PUBLISHABLE_KEY = new InjectionToken('Stripe Publishable Key');\nconst STRIPE_OPTIONS = new InjectionToken('Stripe Options');\nlet StripeScriptTag = /*#__PURE__*/(() => {\n  class StripeScriptTag {\n    constructor(document, key, options) {\n      this.document = document;\n      this.src = \"https://js.stripe.com/v3/\";\n      this.window = this.document.defaultView;\n      this.load = this.injectIntoHead();\n      if (key) this.setPublishableKey(key, options);\n    }\n\n    promiseStripe() {\n      return this.load;\n    }\n\n    promiseInstance() {\n      return this.promiseStripe().then(stripe => {\n        if (!this.StripeInstance) {\n          const err = new Error(\"Stripe PublishableKey NOT SET. Use method StripeScriptTag.setPublishableKey()\");\n          err[\"code\"] = \"STRIPEKEYNOTSET\";\n          throw err; //return Promise.reject( err )\n        }\n\n        return this.StripeInstance;\n      });\n    }\n\n    setPublishableKey(key, options) {\n      return this.load.then(() => this.StripeInstance = this.Stripe(key, options));\n    }\n\n    injectIntoHead() {\n      if (this.window && this.window[\"Stripe\"]) {\n        return Promise.resolve(this.Stripe = this.window[\"Stripe\"]);\n      }\n\n      return new Promise((res, rej) => {\n        const head = this.getTargetTagDropElement();\n        const script = this.document.createElement(\"script\");\n        script.setAttribute(\"src\", this.src);\n        script.setAttribute(\"type\", \"text/javascript\");\n        script.addEventListener(\"load\", () => {\n          this.Stripe = this.grabStripe();\n          res(this.Stripe);\n        });\n        head.appendChild(script);\n      });\n    }\n\n    grabStripe() {\n      return window[\"Stripe\"];\n    }\n\n    getTargetTagDropElement() {\n      let elm = this.document.getElementsByTagName(\"head\");\n      if (elm.length) return elm[0];\n      return this.document.getElementsByTagName(\"body\")[0];\n    }\n\n  }\n\n  StripeScriptTag.ɵfac = function StripeScriptTag_Factory(t) {\n    return new (t || StripeScriptTag)(ɵngcc0.ɵɵinject(DOCUMENT), ɵngcc0.ɵɵinject(STRIPE_PUBLISHABLE_KEY), ɵngcc0.ɵɵinject(STRIPE_OPTIONS));\n  };\n\n  StripeScriptTag.ɵprov = i0.ɵɵdefineInjectable({\n    factory: function StripeScriptTag_Factory() {\n      return new StripeScriptTag(i0.ɵɵinject(i1.DOCUMENT), i0.ɵɵinject(STRIPE_PUBLISHABLE_KEY), i0.ɵɵinject(STRIPE_OPTIONS));\n    },\n    token: StripeScriptTag,\n    providedIn: \"root\"\n  });\n  return StripeScriptTag;\n})();\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\nlet StripeComponent = /*#__PURE__*/(() => {\n  class StripeComponent {\n    constructor(StripeScriptTag) {\n      this.StripeScriptTag = StripeScriptTag;\n      this.catcher = new EventEmitter();\n      this.invalidChange = new EventEmitter();\n    }\n\n    ngOnInit() {\n      this.init();\n    }\n\n    init() {\n      return this.StripeScriptTag.promiseInstance().then(i => this.stripe = i);\n    }\n\n  }\n\n  StripeComponent.ɵfac = function StripeComponent_Factory(t) {\n    return new (t || StripeComponent)(ɵngcc0.ɵɵdirectiveInject(StripeScriptTag));\n  };\n\n  StripeComponent.ɵcmp = /*@__PURE__*/ɵngcc0.ɵɵdefineComponent({\n    type: StripeComponent,\n    selectors: [[\"stripe-component\"]],\n    inputs: {\n      invalid: \"invalid\"\n    },\n    outputs: {\n      catcher: \"catch\",\n      invalidChange: \"invalidChange\"\n    },\n    decls: 0,\n    vars: 0,\n    template: function StripeComponent_Template(rf, ctx) {},\n    encapsulation: 2\n  });\n  return StripeComponent;\n})();\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\nlet StripeSource = /*#__PURE__*/(() => {\n  class StripeSource extends StripeComponent {\n    constructor(StripeScriptTag) {\n      super(StripeScriptTag);\n      this.StripeScriptTag = StripeScriptTag;\n      this.sourceChange = new EventEmitter();\n      this.paymentMethodChange = new EventEmitter();\n    }\n\n    createSource(extraData) {\n      delete this.invalid;\n      this.invalidChange.emit(this.invalid);\n      return this.stripe.createSource(this.elements, extraData).then(result => this.processSourceResult(result));\n    }\n\n    processSourceResult(result) {\n      if (result.error) {\n        const rError = result.error;\n\n        if (rError.type === \"validation_error\") {\n          this.invalidChange.emit(this.invalid = rError);\n        } else {\n          this.catcher.emit(rError);\n          throw rError;\n        }\n      }\n\n      const source = result.source;\n\n      if (source) {\n        this.sourceChange.emit(this.source = source);\n        return source;\n      }\n    }\n\n    createPaymentMethod(extraData) {\n      delete this.invalid;\n      this.invalidChange.emit(this.invalid);\n      return this.stripe.createPaymentMethod('card', this.elements, extraData).then(result => this.processPaymentMethodResult(result));\n    }\n\n    processPaymentMethodResult(result) {\n      if (result.error) {\n        const rError = result.error;\n\n        if (rError.type === \"validation_error\") {\n          this.invalidChange.emit(this.invalid = rError);\n        } else {\n          this.catcher.emit(rError);\n          throw rError;\n        }\n      }\n\n      const paymentMethod = result.paymentMethod;\n\n      if (paymentMethod) {\n        this.paymentMethodChange.emit(this.paymentMethod = paymentMethod);\n        return paymentMethod;\n      }\n    }\n\n  }\n\n  StripeSource.ɵfac = function StripeSource_Factory(t) {\n    return new (t || StripeSource)(ɵngcc0.ɵɵdirectiveInject(StripeScriptTag));\n  };\n\n  StripeSource.ɵcmp = /*@__PURE__*/ɵngcc0.ɵɵdefineComponent({\n    type: StripeSource,\n    selectors: [[\"stripe-source\"]],\n    inputs: {\n      source: \"source\",\n      paymentMethod: \"paymentMethod\"\n    },\n    outputs: {\n      sourceChange: \"sourceChange\",\n      paymentMethodChange: \"paymentMethodChange\"\n    },\n    exportAs: [\"StripeSource\"],\n    features: [ɵngcc0.ɵɵInheritDefinitionFeature],\n    decls: 1,\n    vars: 1,\n    consts: [[4, \"ngIf\"], [2, \"color\", \"red\"]],\n    template: function StripeSource_Template(rf, ctx) {\n      if (rf & 1) {\n        ɵngcc0.ɵɵtemplate(0, StripeSource_ng_container_0_Template, 3, 0, \"ng-container\", 0);\n      }\n\n      if (rf & 2) {\n        ɵngcc0.ɵɵproperty(\"ngIf\", !ctx.StripeScriptTag.StripeInstance);\n      }\n    },\n    dependencies: [ɵngcc1.NgIf],\n    encapsulation: 2\n  });\n  return StripeSource;\n})();\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\nlet StripeCard = /*#__PURE__*/(() => {\n  class StripeCard extends StripeSource {\n    constructor(ElementRef, StripeScriptTag) {\n      super(StripeScriptTag);\n      this.ElementRef = ElementRef;\n      this.StripeScriptTag = StripeScriptTag;\n      this.tokenChange = new EventEmitter();\n      this.cardMounted = new EventEmitter();\n      this.complete = false;\n      this.completeChange = new EventEmitter();\n      this.changed = new EventEmitter();\n      this.drawn = false;\n    }\n\n    ngOnInit() {\n      super.init().then(() => this.redraw());\n    }\n\n    ngOnChanges(changes) {\n      if (this.drawn && (changes.options || changes.createOptions)) {\n        this.redraw();\n      }\n    }\n\n    redraw() {\n      if (this.drawn) {\n        this.elements.unmount();\n        this.elements.destroy();\n      }\n\n      this.elements = this.stripe.elements(this.createOptions).create('card', this.options);\n      this.elements.mount(this.ElementRef.nativeElement);\n      this.cardMounted.emit(this.elements);\n      this.elements.on('change', result => {\n        this.changed.emit(result);\n\n        if (result.complete || this.complete && !result.complete) {\n          this.completeChange.emit(this.complete = result.complete);\n        }\n      });\n      this.elements.addEventListener('change', result => {\n        if (result.error) {\n          this.invalidChange.emit(this.invalid = result.error);\n        }\n      });\n      this.drawn = true;\n    }\n\n    createToken(extraData) {\n      delete this.invalid;\n      this.invalidChange.emit(this.invalid);\n      return this.stripe.createToken(this.elements, extraData).then(result => {\n        if (result.error) {\n          if (result.error.type == \"validation_error\") {\n            this.invalidChange.emit(this.invalid = result.error);\n          } else {\n            this.catcher.emit(result.error);\n            throw result.error;\n          }\n        } else {\n          this.tokenChange.emit(this.token = result.token);\n          return result.token;\n        }\n      });\n    }\n\n  }\n\n  StripeCard.ɵfac = function StripeCard_Factory(t) {\n    return new (t || StripeCard)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(StripeScriptTag));\n  };\n\n  StripeCard.ɵcmp = /*@__PURE__*/ɵngcc0.ɵɵdefineComponent({\n    type: StripeCard,\n    selectors: [[\"stripe-card\"]],\n    inputs: {\n      complete: \"complete\",\n      token: \"token\",\n      createOptions: \"createOptions\",\n      options: \"options\"\n    },\n    outputs: {\n      tokenChange: \"tokenChange\",\n      cardMounted: \"cardMounted\",\n      completeChange: \"completeChange\",\n      changed: \"changed\"\n    },\n    exportAs: [\"StripeCard\"],\n    features: [ɵngcc0.ɵɵInheritDefinitionFeature, ɵngcc0.ɵɵNgOnChangesFeature],\n    decls: 1,\n    vars: 1,\n    consts: [[4, \"ngIf\"], [2, \"color\", \"red\"]],\n    template: function StripeCard_Template(rf, ctx) {\n      if (rf & 1) {\n        ɵngcc0.ɵɵtemplate(0, StripeCard_ng_container_0_Template, 3, 0, \"ng-container\", 0);\n      }\n\n      if (rf & 2) {\n        ɵngcc0.ɵɵproperty(\"ngIf\", !ctx.StripeScriptTag.StripeInstance);\n      }\n    },\n    dependencies: [ɵngcc1.NgIf],\n    encapsulation: 2\n  });\n  return StripeCard;\n})();\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\nlet StripeBank = /*#__PURE__*/(() => {\n  class StripeBank extends StripeComponent {\n    constructor(StripeScriptTag) {\n      super(StripeScriptTag);\n      this.StripeScriptTag = StripeScriptTag;\n      this.tokenChange = new EventEmitter();\n    }\n\n    createToken(data) {\n      delete this.invalid;\n      this.invalidChange.emit(this.invalid);\n      return this.stripe.createToken('bank_account', data).then(result => {\n        if (result.error) {\n          if (result.error.type == \"validation_error\") {\n            this.invalidChange.emit(this.invalid = result.error);\n          } else {\n            this.catcher.emit(result.error);\n            throw result.error;\n          }\n        } else {\n          this.tokenChange.emit(this.token = result.token);\n          return result.token;\n        }\n      });\n    }\n\n  }\n\n  StripeBank.ɵfac = function StripeBank_Factory(t) {\n    return new (t || StripeBank)(ɵngcc0.ɵɵdirectiveInject(StripeScriptTag));\n  };\n\n  StripeBank.ɵcmp = /*@__PURE__*/ɵngcc0.ɵɵdefineComponent({\n    type: StripeBank,\n    selectors: [[\"stripe-bank\"]],\n    inputs: {\n      token: \"token\",\n      options: \"options\"\n    },\n    outputs: {\n      tokenChange: \"tokenChange\"\n    },\n    exportAs: [\"StripeBank\"],\n    features: [ɵngcc0.ɵɵInheritDefinitionFeature],\n    decls: 1,\n    vars: 1,\n    consts: [[4, \"ngIf\"], [2, \"color\", \"red\"]],\n    template: function StripeBank_Template(rf, ctx) {\n      if (rf & 1) {\n        ɵngcc0.ɵɵtemplate(0, StripeBank_ng_container_0_Template, 3, 0, \"ng-container\", 0);\n      }\n\n      if (rf & 2) {\n        ɵngcc0.ɵɵproperty(\"ngIf\", !ctx.StripeScriptTag.StripeInstance);\n      }\n    },\n    dependencies: [ɵngcc1.NgIf],\n    encapsulation: 2\n  });\n  return StripeBank;\n})();\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\nconst declarations = [StripeComponent, StripeSource, StripeCard, StripeBank];\nlet StripeModule = /*#__PURE__*/(() => {\n  class StripeModule {\n    static forRoot(publishableKey, options) {\n      return {\n        ngModule: StripeModule,\n        providers: [StripeScriptTag, {\n          provide: STRIPE_PUBLISHABLE_KEY,\n          useValue: publishableKey\n        }, {\n          provide: STRIPE_OPTIONS,\n          useValue: options\n        }]\n      };\n    }\n\n  }\n\n  StripeModule.ɵfac = function StripeModule_Factory(t) {\n    return new (t || StripeModule)();\n  };\n\n  StripeModule.ɵmod = /*@__PURE__*/ɵngcc0.ɵɵdefineNgModule({\n    type: StripeModule\n  });\n  StripeModule.ɵinj = /*@__PURE__*/ɵngcc0.ɵɵdefineInjector({\n    imports: [CommonModule]\n  });\n  return StripeModule;\n})();\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n(function () {\n  (typeof ngJitMode === \"undefined\" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(StripeModule, {\n    declarations: function () {\n      return [StripeComponent, StripeSource, StripeCard, StripeBank];\n    },\n    imports: function () {\n      return [CommonModule];\n    },\n    exports: function () {\n      return [StripeComponent, StripeSource, StripeCard, StripeBank];\n    }\n  });\n})();\n/**\n * @deprecated Please import `StripeModule` directly\n */\n\n\nconst Module = StripeModule;\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { Module, STRIPE_OPTIONS, STRIPE_PUBLISHABLE_KEY, StripeBank, StripeCard, StripeModule, StripeScriptTag, StripeSource, StripeComponent as ɵa }; //# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RyaXBlLWFuZ3VsYXIuanMiLCJzb3VyY2VzIjpbInN0cmlwZS1hbmd1bGFyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO3VNQUFDO0FBQ0QsdVFBR0U7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7O2tDQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzswVEFLRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OzBEQVdFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OzBEQVdFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7MERBV0U7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7OzhWQVVFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGkwIGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSW5qZWN0aW9uVG9rZW4sIEluamVjdGFibGUsIEluamVjdCwgRXZlbnRFbWl0dGVyLCBDb21wb25lbnQsIE91dHB1dCwgSW5wdXQsIEVsZW1lbnRSZWYsIE5nTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgKiBhcyBpMSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgRE9DVU1FTlQsIENvbW1vbk1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5cbmNvbnN0IFNUUklQRV9QVUJMSVNIQUJMRV9LRVkgPSBuZXcgSW5qZWN0aW9uVG9rZW4oJ1N0cmlwZSBQdWJsaXNoYWJsZSBLZXknKTtcbmNvbnN0IFNUUklQRV9PUFRJT05TID0gbmV3IEluamVjdGlvblRva2VuKCdTdHJpcGUgT3B0aW9ucycpO1xuXG5jbGFzcyBTdHJpcGVTY3JpcHRUYWcge1xuICAgIGNvbnN0cnVjdG9yKGRvY3VtZW50LCBrZXksIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5kb2N1bWVudCA9IGRvY3VtZW50O1xuICAgICAgICB0aGlzLnNyYyA9IFwiaHR0cHM6Ly9qcy5zdHJpcGUuY29tL3YzL1wiO1xuICAgICAgICB0aGlzLndpbmRvdyA9IHRoaXMuZG9jdW1lbnQuZGVmYXVsdFZpZXc7XG4gICAgICAgIHRoaXMubG9hZCA9IHRoaXMuaW5qZWN0SW50b0hlYWQoKTtcbiAgICAgICAgaWYgKGtleSlcbiAgICAgICAgICAgIHRoaXMuc2V0UHVibGlzaGFibGVLZXkoa2V5LCBvcHRpb25zKTtcbiAgICB9XG4gICAgcHJvbWlzZVN0cmlwZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZDtcbiAgICB9XG4gICAgcHJvbWlzZUluc3RhbmNlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9taXNlU3RyaXBlKClcbiAgICAgICAgICAgIC50aGVuKHN0cmlwZSA9PiB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuU3RyaXBlSW5zdGFuY2UpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlcnIgPSBuZXcgRXJyb3IoXCJTdHJpcGUgUHVibGlzaGFibGVLZXkgTk9UIFNFVC4gVXNlIG1ldGhvZCBTdHJpcGVTY3JpcHRUYWcuc2V0UHVibGlzaGFibGVLZXkoKVwiKTtcbiAgICAgICAgICAgICAgICBlcnJbXCJjb2RlXCJdID0gXCJTVFJJUEVLRVlOT1RTRVRcIjtcbiAgICAgICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgICAgICAgICAgLy9yZXR1cm4gUHJvbWlzZS5yZWplY3QoIGVyciApXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5TdHJpcGVJbnN0YW5jZTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHNldFB1Ymxpc2hhYmxlS2V5KGtleSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gdGhpcy5sb2FkLnRoZW4oKCkgPT4gdGhpcy5TdHJpcGVJbnN0YW5jZSA9IHRoaXMuU3RyaXBlKGtleSwgb3B0aW9ucykpO1xuICAgIH1cbiAgICBpbmplY3RJbnRvSGVhZCgpIHtcbiAgICAgICAgaWYgKHRoaXMud2luZG93ICYmIHRoaXMud2luZG93W1wiU3RyaXBlXCJdKSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMuU3RyaXBlID0gdGhpcy53aW5kb3dbXCJTdHJpcGVcIl0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzLCByZWopID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGhlYWQgPSB0aGlzLmdldFRhcmdldFRhZ0Ryb3BFbGVtZW50KCk7XG4gICAgICAgICAgICBjb25zdCBzY3JpcHQgPSB0aGlzLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzY3JpcHRcIik7XG4gICAgICAgICAgICBzY3JpcHQuc2V0QXR0cmlidXRlKFwic3JjXCIsIHRoaXMuc3JjKTtcbiAgICAgICAgICAgIHNjcmlwdC5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwidGV4dC9qYXZhc2NyaXB0XCIpO1xuICAgICAgICAgICAgc2NyaXB0LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLlN0cmlwZSA9IHRoaXMuZ3JhYlN0cmlwZSgpO1xuICAgICAgICAgICAgICAgIHJlcyh0aGlzLlN0cmlwZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGdyYWJTdHJpcGUoKSB7XG4gICAgICAgIHJldHVybiB3aW5kb3dbXCJTdHJpcGVcIl07XG4gICAgfVxuICAgIGdldFRhcmdldFRhZ0Ryb3BFbGVtZW50KCkge1xuICAgICAgICBsZXQgZWxtID0gdGhpcy5kb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImhlYWRcIik7XG4gICAgICAgIGlmIChlbG0ubGVuZ3RoKVxuICAgICAgICAgICAgcmV0dXJuIGVsbVswXTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJib2R5XCIpWzBdO1xuICAgIH1cbn1cblN0cmlwZVNjcmlwdFRhZy7JtXByb3YgPSBpMC7Jtcm1ZGVmaW5lSW5qZWN0YWJsZSh7IGZhY3Rvcnk6IGZ1bmN0aW9uIFN0cmlwZVNjcmlwdFRhZ19GYWN0b3J5KCkgeyByZXR1cm4gbmV3IFN0cmlwZVNjcmlwdFRhZyhpMC7Jtcm1aW5qZWN0KGkxLkRPQ1VNRU5UKSwgaTAuybXJtWluamVjdChTVFJJUEVfUFVCTElTSEFCTEVfS0VZKSwgaTAuybXJtWluamVjdChTVFJJUEVfT1BUSU9OUykpOyB9LCB0b2tlbjogU3RyaXBlU2NyaXB0VGFnLCBwcm92aWRlZEluOiBcInJvb3RcIiB9KTtcblN0cmlwZVNjcmlwdFRhZy5kZWNvcmF0b3JzID0gW1xuICAgIHsgdHlwZTogSW5qZWN0YWJsZSwgYXJnczogW3sgcHJvdmlkZWRJbjogJ3Jvb3QnIH0sXSB9XG5dO1xuU3RyaXBlU2NyaXB0VGFnLmN0b3JQYXJhbWV0ZXJzID0gKCkgPT4gW1xuICAgIHsgdHlwZTogdW5kZWZpbmVkLCBkZWNvcmF0b3JzOiBbeyB0eXBlOiBJbmplY3QsIGFyZ3M6IFtET0NVTUVOVCxdIH1dIH0sXG4gICAgeyB0eXBlOiBTdHJpbmcsIGRlY29yYXRvcnM6IFt7IHR5cGU6IEluamVjdCwgYXJnczogW1NUUklQRV9QVUJMSVNIQUJMRV9LRVksXSB9XSB9LFxuICAgIHsgdHlwZTogdW5kZWZpbmVkLCBkZWNvcmF0b3JzOiBbeyB0eXBlOiBJbmplY3QsIGFyZ3M6IFtTVFJJUEVfT1BUSU9OUyxdIH1dIH1cbl07XG5cbmNsYXNzIFN0cmlwZUNvbXBvbmVudCB7XG4gICAgY29uc3RydWN0b3IoU3RyaXBlU2NyaXB0VGFnKSB7XG4gICAgICAgIHRoaXMuU3RyaXBlU2NyaXB0VGFnID0gU3RyaXBlU2NyaXB0VGFnO1xuICAgICAgICB0aGlzLmNhdGNoZXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMuaW52YWxpZENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICB9XG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuaW5pdCgpO1xuICAgIH1cbiAgICBpbml0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5TdHJpcGVTY3JpcHRUYWcucHJvbWlzZUluc3RhbmNlKClcbiAgICAgICAgICAgIC50aGVuKGkgPT4gdGhpcy5zdHJpcGUgPSBpKTtcbiAgICB9XG59XG5TdHJpcGVDb21wb25lbnQuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IENvbXBvbmVudCwgYXJnczogW3tcbiAgICAgICAgICAgICAgICBzZWxlY3RvcjogXCJzdHJpcGUtY29tcG9uZW50XCIsIHRlbXBsYXRlOiBgYFxuICAgICAgICAgICAgfSxdIH1cbl07XG5TdHJpcGVDb21wb25lbnQuY3RvclBhcmFtZXRlcnMgPSAoKSA9PiBbXG4gICAgeyB0eXBlOiBTdHJpcGVTY3JpcHRUYWcgfVxuXTtcblN0cmlwZUNvbXBvbmVudC5wcm9wRGVjb3JhdG9ycyA9IHtcbiAgICBjYXRjaGVyOiBbeyB0eXBlOiBPdXRwdXQsIGFyZ3M6IFtcImNhdGNoXCIsXSB9XSxcbiAgICBpbnZhbGlkOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBpbnZhbGlkQ2hhbmdlOiBbeyB0eXBlOiBPdXRwdXQgfV1cbn07XG5cbmNsYXNzIFN0cmlwZVNvdXJjZSBleHRlbmRzIFN0cmlwZUNvbXBvbmVudCB7XG4gICAgY29uc3RydWN0b3IoU3RyaXBlU2NyaXB0VGFnKSB7XG4gICAgICAgIHN1cGVyKFN0cmlwZVNjcmlwdFRhZyk7XG4gICAgICAgIHRoaXMuU3RyaXBlU2NyaXB0VGFnID0gU3RyaXBlU2NyaXB0VGFnO1xuICAgICAgICB0aGlzLnNvdXJjZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5wYXltZW50TWV0aG9kQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIH1cbiAgICBjcmVhdGVTb3VyY2UoZXh0cmFEYXRhKSB7XG4gICAgICAgIGRlbGV0ZSB0aGlzLmludmFsaWQ7XG4gICAgICAgIHRoaXMuaW52YWxpZENoYW5nZS5lbWl0KHRoaXMuaW52YWxpZCk7XG4gICAgICAgIHJldHVybiB0aGlzLnN0cmlwZS5jcmVhdGVTb3VyY2UodGhpcy5lbGVtZW50cywgZXh0cmFEYXRhKVxuICAgICAgICAgICAgLnRoZW4oKHJlc3VsdCkgPT4gdGhpcy5wcm9jZXNzU291cmNlUmVzdWx0KHJlc3VsdCkpO1xuICAgIH1cbiAgICBwcm9jZXNzU291cmNlUmVzdWx0KHJlc3VsdCkge1xuICAgICAgICBpZiAocmVzdWx0LmVycm9yKSB7XG4gICAgICAgICAgICBjb25zdCByRXJyb3IgPSByZXN1bHQuZXJyb3I7XG4gICAgICAgICAgICBpZiAockVycm9yLnR5cGUgPT09IFwidmFsaWRhdGlvbl9lcnJvclwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnZhbGlkQ2hhbmdlLmVtaXQodGhpcy5pbnZhbGlkID0gckVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuY2F0Y2hlci5lbWl0KHJFcnJvcik7XG4gICAgICAgICAgICAgICAgdGhyb3cgckVycm9yO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNvdXJjZSA9IHJlc3VsdC5zb3VyY2U7XG4gICAgICAgIGlmIChzb3VyY2UpIHtcbiAgICAgICAgICAgIHRoaXMuc291cmNlQ2hhbmdlLmVtaXQodGhpcy5zb3VyY2UgPSBzb3VyY2UpO1xuICAgICAgICAgICAgcmV0dXJuIHNvdXJjZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjcmVhdGVQYXltZW50TWV0aG9kKGV4dHJhRGF0YSkge1xuICAgICAgICBkZWxldGUgdGhpcy5pbnZhbGlkO1xuICAgICAgICB0aGlzLmludmFsaWRDaGFuZ2UuZW1pdCh0aGlzLmludmFsaWQpO1xuICAgICAgICByZXR1cm4gdGhpcy5zdHJpcGUuY3JlYXRlUGF5bWVudE1ldGhvZCgnY2FyZCcsIHRoaXMuZWxlbWVudHMsIGV4dHJhRGF0YSlcbiAgICAgICAgICAgIC50aGVuKChyZXN1bHQpID0+IHRoaXMucHJvY2Vzc1BheW1lbnRNZXRob2RSZXN1bHQocmVzdWx0KSk7XG4gICAgfVxuICAgIHByb2Nlc3NQYXltZW50TWV0aG9kUmVzdWx0KHJlc3VsdCkge1xuICAgICAgICBpZiAocmVzdWx0LmVycm9yKSB7XG4gICAgICAgICAgICBjb25zdCByRXJyb3IgPSByZXN1bHQuZXJyb3I7XG4gICAgICAgICAgICBpZiAockVycm9yLnR5cGUgPT09IFwidmFsaWRhdGlvbl9lcnJvclwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnZhbGlkQ2hhbmdlLmVtaXQodGhpcy5pbnZhbGlkID0gckVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuY2F0Y2hlci5lbWl0KHJFcnJvcik7XG4gICAgICAgICAgICAgICAgdGhyb3cgckVycm9yO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBheW1lbnRNZXRob2QgPSByZXN1bHQucGF5bWVudE1ldGhvZDtcbiAgICAgICAgaWYgKHBheW1lbnRNZXRob2QpIHtcbiAgICAgICAgICAgIHRoaXMucGF5bWVudE1ldGhvZENoYW5nZS5lbWl0KHRoaXMucGF5bWVudE1ldGhvZCA9IHBheW1lbnRNZXRob2QpO1xuICAgICAgICAgICAgcmV0dXJuIHBheW1lbnRNZXRob2Q7XG4gICAgICAgIH1cbiAgICB9XG59XG5TdHJpcGVTb3VyY2UuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IENvbXBvbmVudCwgYXJnczogW3tcbiAgICAgICAgICAgICAgICBzZWxlY3RvcjogXCJzdHJpcGUtc291cmNlXCIsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6IGBcbiAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCIhU3RyaXBlU2NyaXB0VGFnLlN0cmlwZUluc3RhbmNlXCI+XG4gICAgICAgICAgPGRpdiBzdHlsZT1cImNvbG9yOnJlZDtcIj5TdHJpcGUgUHVibGlzaGFibGVLZXkgTk9UIFNFVC4gVXNlIG1ldGhvZCBTdHJpcGVTY3JpcHRUYWcuc2V0UHVibGlzaGFibGVLZXkoKTwvZGl2PlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gIGAsXG4gICAgICAgICAgICAgICAgZXhwb3J0QXM6IFwiU3RyaXBlU291cmNlXCJcbiAgICAgICAgICAgIH0sXSB9XG5dO1xuU3RyaXBlU291cmNlLmN0b3JQYXJhbWV0ZXJzID0gKCkgPT4gW1xuICAgIHsgdHlwZTogU3RyaXBlU2NyaXB0VGFnIH1cbl07XG5TdHJpcGVTb3VyY2UucHJvcERlY29yYXRvcnMgPSB7XG4gICAgc291cmNlOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBzb3VyY2VDaGFuZ2U6IFt7IHR5cGU6IE91dHB1dCB9XSxcbiAgICBwYXltZW50TWV0aG9kOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBwYXltZW50TWV0aG9kQ2hhbmdlOiBbeyB0eXBlOiBPdXRwdXQgfV1cbn07XG5cbmNsYXNzIFN0cmlwZUNhcmQgZXh0ZW5kcyBTdHJpcGVTb3VyY2Uge1xuICAgIGNvbnN0cnVjdG9yKEVsZW1lbnRSZWYsIFN0cmlwZVNjcmlwdFRhZykge1xuICAgICAgICBzdXBlcihTdHJpcGVTY3JpcHRUYWcpO1xuICAgICAgICB0aGlzLkVsZW1lbnRSZWYgPSBFbGVtZW50UmVmO1xuICAgICAgICB0aGlzLlN0cmlwZVNjcmlwdFRhZyA9IFN0cmlwZVNjcmlwdFRhZztcbiAgICAgICAgdGhpcy50b2tlbkNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5jYXJkTW91bnRlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5jb21wbGV0ZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNvbXBsZXRlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLmNoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMuZHJhd24gPSBmYWxzZTtcbiAgICB9XG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHN1cGVyLmluaXQoKS50aGVuKCgpID0+IHRoaXMucmVkcmF3KCkpO1xuICAgIH1cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzKSB7XG4gICAgICAgIGlmICh0aGlzLmRyYXduICYmIChjaGFuZ2VzLm9wdGlvbnMgfHwgY2hhbmdlcy5jcmVhdGVPcHRpb25zKSkge1xuICAgICAgICAgICAgdGhpcy5yZWRyYXcoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZWRyYXcoKSB7XG4gICAgICAgIGlmICh0aGlzLmRyYXduKSB7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzLnVubW91bnQoKTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudHMuZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZWxlbWVudHMgPSB0aGlzLnN0cmlwZS5lbGVtZW50cyh0aGlzLmNyZWF0ZU9wdGlvbnMpLmNyZWF0ZSgnY2FyZCcsIHRoaXMub3B0aW9ucyk7XG4gICAgICAgIHRoaXMuZWxlbWVudHMubW91bnQodGhpcy5FbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgICB0aGlzLmNhcmRNb3VudGVkLmVtaXQodGhpcy5lbGVtZW50cyk7XG4gICAgICAgIHRoaXMuZWxlbWVudHMub24oJ2NoYW5nZScsIChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlZC5lbWl0KHJlc3VsdCk7XG4gICAgICAgICAgICBpZiAocmVzdWx0LmNvbXBsZXRlIHx8ICh0aGlzLmNvbXBsZXRlICYmICFyZXN1bHQuY29tcGxldGUpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb21wbGV0ZUNoYW5nZS5lbWl0KHRoaXMuY29tcGxldGUgPSByZXN1bHQuY29tcGxldGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5lbGVtZW50cy5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzdWx0LmVycm9yKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnZhbGlkQ2hhbmdlLmVtaXQodGhpcy5pbnZhbGlkID0gcmVzdWx0LmVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZHJhd24gPSB0cnVlO1xuICAgIH1cbiAgICBjcmVhdGVUb2tlbihleHRyYURhdGEpIHtcbiAgICAgICAgZGVsZXRlIHRoaXMuaW52YWxpZDtcbiAgICAgICAgdGhpcy5pbnZhbGlkQ2hhbmdlLmVtaXQodGhpcy5pbnZhbGlkKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RyaXBlLmNyZWF0ZVRva2VuKHRoaXMuZWxlbWVudHMsIGV4dHJhRGF0YSlcbiAgICAgICAgICAgIC50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGlmIChyZXN1bHQuZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmVycm9yLnR5cGUgPT0gXCJ2YWxpZGF0aW9uX2Vycm9yXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnZhbGlkQ2hhbmdlLmVtaXQodGhpcy5pbnZhbGlkID0gcmVzdWx0LmVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2F0Y2hlci5lbWl0KHJlc3VsdC5lcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IHJlc3VsdC5lcnJvcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRva2VuQ2hhbmdlLmVtaXQodGhpcy50b2tlbiA9IHJlc3VsdC50b2tlbik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC50b2tlbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufVxuU3RyaXBlQ2FyZC5kZWNvcmF0b3JzID0gW1xuICAgIHsgdHlwZTogQ29tcG9uZW50LCBhcmdzOiBbe1xuICAgICAgICAgICAgICAgIHNlbGVjdG9yOiBcInN0cmlwZS1jYXJkXCIsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6IGBcbiAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCIhU3RyaXBlU2NyaXB0VGFnLlN0cmlwZUluc3RhbmNlXCI+XG4gICAgICAgICAgPGRpdiBzdHlsZT1cImNvbG9yOnJlZDtcIj5TdHJpcGUgUHVibGlzaGFibGVLZXkgTk9UIFNFVC4gVXNlIG1ldGhvZCBTdHJpcGVTY3JpcHRUYWcuc2V0UHVibGlzaGFibGVLZXkoKTwvZGl2PlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gIGAsXG4gICAgICAgICAgICAgICAgZXhwb3J0QXM6IFwiU3RyaXBlQ2FyZFwiXG4gICAgICAgICAgICB9LF0gfVxuXTtcblN0cmlwZUNhcmQuY3RvclBhcmFtZXRlcnMgPSAoKSA9PiBbXG4gICAgeyB0eXBlOiBFbGVtZW50UmVmIH0sXG4gICAgeyB0eXBlOiBTdHJpcGVTY3JpcHRUYWcgfVxuXTtcblN0cmlwZUNhcmQucHJvcERlY29yYXRvcnMgPSB7XG4gICAgY3JlYXRlT3B0aW9uczogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgb3B0aW9uczogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgdG9rZW46IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIHRva2VuQ2hhbmdlOiBbeyB0eXBlOiBPdXRwdXQgfV0sXG4gICAgY2FyZE1vdW50ZWQ6IFt7IHR5cGU6IE91dHB1dCB9XSxcbiAgICBjb21wbGV0ZTogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgY29tcGxldGVDaGFuZ2U6IFt7IHR5cGU6IE91dHB1dCB9XSxcbiAgICBjaGFuZ2VkOiBbeyB0eXBlOiBPdXRwdXQgfV1cbn07XG5cbmNsYXNzIFN0cmlwZUJhbmsgZXh0ZW5kcyBTdHJpcGVDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKFN0cmlwZVNjcmlwdFRhZykge1xuICAgICAgICBzdXBlcihTdHJpcGVTY3JpcHRUYWcpO1xuICAgICAgICB0aGlzLlN0cmlwZVNjcmlwdFRhZyA9IFN0cmlwZVNjcmlwdFRhZztcbiAgICAgICAgdGhpcy50b2tlbkNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICB9XG4gICAgY3JlYXRlVG9rZW4oZGF0YSkge1xuICAgICAgICBkZWxldGUgdGhpcy5pbnZhbGlkO1xuICAgICAgICB0aGlzLmludmFsaWRDaGFuZ2UuZW1pdCh0aGlzLmludmFsaWQpO1xuICAgICAgICByZXR1cm4gdGhpcy5zdHJpcGUuY3JlYXRlVG9rZW4oJ2JhbmtfYWNjb3VudCcsIGRhdGEpXG4gICAgICAgICAgICAudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzdWx0LmVycm9yKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5lcnJvci50eXBlID09IFwidmFsaWRhdGlvbl9lcnJvclwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW52YWxpZENoYW5nZS5lbWl0KHRoaXMuaW52YWxpZCA9IHJlc3VsdC5lcnJvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNhdGNoZXIuZW1pdChyZXN1bHQuZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyByZXN1bHQuZXJyb3I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy50b2tlbkNoYW5nZS5lbWl0KHRoaXMudG9rZW4gPSByZXN1bHQudG9rZW4pO1xuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQudG9rZW47XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblN0cmlwZUJhbmsuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IENvbXBvbmVudCwgYXJnczogW3tcbiAgICAgICAgICAgICAgICBzZWxlY3RvcjogXCJzdHJpcGUtYmFua1wiLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBgXG4gICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiIVN0cmlwZVNjcmlwdFRhZy5TdHJpcGVJbnN0YW5jZVwiPlxuICAgICAgICAgIDxkaXYgc3R5bGU9XCJjb2xvcjpyZWQ7XCI+U3RyaXBlIFB1Ymxpc2hhYmxlS2V5IE5PVCBTRVQuIFVzZSBtZXRob2QgU3RyaXBlU2NyaXB0VGFnLnNldFB1Ymxpc2hhYmxlS2V5KCk8L2Rpdj5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuICBgLFxuICAgICAgICAgICAgICAgIGV4cG9ydEFzOiBcIlN0cmlwZUJhbmtcIlxuICAgICAgICAgICAgfSxdIH1cbl07XG5TdHJpcGVCYW5rLmN0b3JQYXJhbWV0ZXJzID0gKCkgPT4gW1xuICAgIHsgdHlwZTogU3RyaXBlU2NyaXB0VGFnIH1cbl07XG5TdHJpcGVCYW5rLnByb3BEZWNvcmF0b3JzID0ge1xuICAgIG9wdGlvbnM6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIHRva2VuOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICB0b2tlbkNoYW5nZTogW3sgdHlwZTogT3V0cHV0IH1dXG59O1xuXG5jb25zdCBkZWNsYXJhdGlvbnMgPSBbXG4gICAgU3RyaXBlQ29tcG9uZW50LFxuICAgIFN0cmlwZVNvdXJjZSxcbiAgICBTdHJpcGVDYXJkLFxuICAgIFN0cmlwZUJhbmtcbl07XG5jbGFzcyBTdHJpcGVNb2R1bGUge1xuICAgIHN0YXRpYyBmb3JSb290KHB1Ymxpc2hhYmxlS2V5LCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBuZ01vZHVsZTogU3RyaXBlTW9kdWxlLFxuICAgICAgICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgICAgICAgICAgU3RyaXBlU2NyaXB0VGFnLFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvdmlkZTogU1RSSVBFX1BVQkxJU0hBQkxFX0tFWSxcbiAgICAgICAgICAgICAgICAgICAgdXNlVmFsdWU6IHB1Ymxpc2hhYmxlS2V5XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHByb3ZpZGU6IFNUUklQRV9PUFRJT05TLFxuICAgICAgICAgICAgICAgICAgICB1c2VWYWx1ZTogb3B0aW9uc1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF0sXG4gICAgICAgIH07XG4gICAgfVxufVxuU3RyaXBlTW9kdWxlLmRlY29yYXRvcnMgPSBbXG4gICAgeyB0eXBlOiBOZ01vZHVsZSwgYXJnczogW3tcbiAgICAgICAgICAgICAgICBpbXBvcnRzOiBbXG4gICAgICAgICAgICAgICAgICAgIENvbW1vbk1vZHVsZVxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgZGVjbGFyYXRpb25zLFxuICAgICAgICAgICAgICAgIC8vIHByb3ZpZGVyczogWyBTdHJpcGVTY3JpcHRUYWcgXSxcbiAgICAgICAgICAgICAgICBleHBvcnRzOiBbLi4uZGVjbGFyYXRpb25zXVxuICAgICAgICAgICAgfSxdIH1cbl07XG4vKipcbiAqIEBkZXByZWNhdGVkIFBsZWFzZSBpbXBvcnQgYFN0cmlwZU1vZHVsZWAgZGlyZWN0bHlcbiAqL1xuY29uc3QgTW9kdWxlID0gU3RyaXBlTW9kdWxlO1xuXG4vKipcbiAqIEdlbmVyYXRlZCBidW5kbGUgaW5kZXguIERvIG5vdCBlZGl0LlxuICovXG5cbmV4cG9ydCB7IE1vZHVsZSwgU1RSSVBFX09QVElPTlMsIFNUUklQRV9QVUJMSVNIQUJMRV9LRVksIFN0cmlwZUJhbmssIFN0cmlwZUNhcmQsIFN0cmlwZU1vZHVsZSwgU3RyaXBlU2NyaXB0VGFnLCBTdHJpcGVTb3VyY2UsIFN0cmlwZUNvbXBvbmVudCBhcyDJtWEgfTtcbiJdfQ==","map":null,"metadata":{},"sourceType":"module"}