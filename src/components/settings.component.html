<div *ngIf="!edit else storageForm">
  <div class="flex flex-wrap text-smx child-margin">
    <div class="flex-1">
      <strong class="nowrap">🗝 Publishable Key</strong>
      <div class="flex-valign-center">
        <masked-key [value]="storage.key"></masked-key>
        <key-changer [keys]="storage.publicKeys" [(value)]="storage.key"
          (valueChange) = "tempPublishableKey=$event;save()"
        ></key-changer>
      </div>
    </div>

    <div class="flex-1">
      <strong class="nowrap">🔐 Private Key</strong>
      <div class="flex-valign-center">
        <masked-key [value]="storage.privateKey"></masked-key>
        <key-changer [keys]="storage.privateKeys" [(value)]="storage.privateKey"
          (valueChange) = "save()"
        ></key-changer>
      </div>
    </div>

    <div *ngIf="storage.webhookSigningSecret" class="flex-1">
      <strong class="nowrap">🪝 Webhook Signing Secret</strong>
      <div class="flex-valign-center">
        <masked-key [value]="storage.webhookSigningSecret"></masked-key>
        <key-changer [keys]="storage.webhookSigningSecrets" [(value)]="storage.webhookSigningSecret"
          (valueChange) = "storage.webhookSigningSecret=$event;save()"
        ></key-changer>
      </div>
    </div>
  </div>

  <br />

  <div class="flex flex-wrap child-margin-xxs">
    <button type="button" (click)="copyShareUrl()" class="flex1 hover-bg-positive active-bg-balanced"
    >✍️ copy share url</button>

    <button type="button" class="flex1 hover-bg-positive active-bg-balanced"
      (click)="editChange.emit(edit = !edit)"
    >🔧 edit</button>
  </div>
</div>

<ng-template #storageForm>
  <form (submit)="save();editChange.emit(edit=false)" (change)="save()">
    <div class="flex-wrap child-margin-xxs child-pad-xxs">
      
      <div class="flex2 bg-grey" style="min-width:30vw">
        <div class="flex-apart">
          <strong class="nowrap">👁 🗝 Public Keys</strong>
          <div class="flex-1 text-center pad-left">
            <a class="text-xxs text-white opacity-half nowrap" target="_blank"
              href="https://dashboard.stripe.com/test/apikeys"
            >🔗 stripe keys</a>
          </div>
        </div>
        <div>
          <keys-input-array inputType="password" [array]="storage.publicKeys"
            [(value)]="storage.key" allowChange="1" inputPlaceholder="🔑 value"
            (selectedChange)="publicKeyChange.emit($event)"
          >
            <ng-template #valueFooter let-value="value">
              <div class="pos-rel width-full">
                <div class="pos-abs opacity-70 text-xxxs text-center width-full pad-top-xs" style="top:-.9em">
                  <masked-key [value]="value"></masked-key>
                </div>      
              </div>
            </ng-template>
          </keys-input-array>
        </div>
      </div>

      <div class="bg-grey flex1 nowrap">
        <div>
          <label for="storage.savePrivateKeyLocally">
            <input
              type="checkbox" name="storage.savePrivateKeyLocally" id="storage.savePrivateKeyLocally"
              (change)="toggleServerMode()"
              [checked] = "storage.savePrivateKeyLocally"
            />
            <span>&nbsp;🔗 enable server functionality</span>
          </label>
        </div>
        
        <div class="pad-top">
          <label for="saveKeyLocally">
            <input
              type="checkbox" name="saveKeyLocally" id="saveKeyLocally"
              (change)="storage.saveKeyLocally = !storage.saveKeyLocally"
              [checked] = "storage.saveKeyLocally"
            />
            <span>&nbsp;💾 save in localStorage</span>
          </label>
        </div>
      </div>

      <ng-container *ngIf="storage.savePrivateKeyLocally">
        <div *ngIf="storage.savePrivateKeyLocally" class="flex1 bg-grey">
          <div class="flex-apart">
            <strong class="nowrap">🔐 Private Keys</strong>
            <div class="flex-1 text-center pad-left">
              <a class="text-xxs text-white opacity-half nowrap" target="_blank"
                href="https://dashboard.stripe.com/test/apikeys"
              >🔗 stripe keys</a>
            </div>
          </div>
          <div>
            <keys-input-array inputType="password" [array]="storage.privateKeys" [(value)]="storage.privateKey" allowChange="1" inputPlaceholder="🔑 value">
              <ng-template #valueFooter let-value="value">
                <div class="pos-rel">
                  <div class="pos-abs opacity-70 text-xxxs text-center width-full pad-top-xs" style="top:-.9em">
                    <masked-key [value]="value"></masked-key>
                  </div>      
                </div>
              </ng-template>
            </keys-input-array>
          </div>
        </div>

        <div class="flex1 bg-grey">
          <webhook-secret-edit (save)="save()"></webhook-secret-edit>
        </div>

        <div class="flex1 bg-grey">
          <webhook-server-edit (save)="save()"></webhook-server-edit>
        </div>

        <fieldset class="radius-10 width-full">
          <legend>🏦 Plaid</legend>
          <div class="flex-wrap child-margin-xxs child-pad-xs">
            <div class="flex1 bg-grey">
              <strong class="nowrap">🆔 Plaid CLIENT_IDs</strong>
              <small class="block opacity-half text-xxxs text-center">
                Store multiple keys for convenient switching
              </small>
              <div>
                <keys-input-array inputType="password" [array]="storage.plaid.clientIds" [(value)]="storage.plaid.client_id" allowChange="1" inputPlaceholder="🔑 value">
                  <ng-template #valueFooter let-value="value">
                    <div class="pos-rel width-full">
                      <div class="pos-abs opacity-70 text-xxxs text-center width-full pad-top-xs" style="top:-.9em">
                        <masked-key [value]="value"></masked-key>
                      </div>      
                    </div>
                  </ng-template>
                </keys-input-array>
              </div>
            </div>

            <div *ngIf="storage.savePrivateKeyLocally" class="flex1 bg-grey">
              <strong class="nowrap">👂 Secrets</strong>
              <small class="block opacity-half text-xxxs text-center">
                Store multiple keys for convenient switching
              </small>
              <div>
                <keys-input-array inputType="password"
                  [array]="storage.plaid.secrets"
                  [value]="storage.plaid.secret"
                  inputPlaceholder="🔑 value"
                  allowChange="1"
                >
                  <ng-template #valueFooter let-value="value">
                    <div class="pos-rel width-full">
                      <div class="pos-abs opacity-70 text-xxxs text-center width-full pad-top-xs" style="top:-.9em">
                        <masked-key [value]="value"></masked-key>
                      </div>      
                    </div>
                  </ng-template>
                </keys-input-array>
              </div>
            </div>
          </div>
        </fieldset>
      </ng-container>
    </div>

    <!-- reusable metadata -->
    <div class="margin-xxs pad-xs bg-grey">
      <div>
        <div>
          <strong>
            <label for="saveRequestsLocal" title="Greatly assists coming back to this interface">
              <input
                type="checkbox" name="saveRequestsLocal" id="saveRequestsLocal"
                (change)="storage.saveRequestsLocal = !storage.saveRequestsLocal"
                [checked] = "storage.saveRequestsLocal"
              /> Reuse metadata in all requests
            </label>
          </strong>
        </div>
        <textarea [disabled]="!storage.saveRequestsLocal" wrap="off" style="width:100%;height:20vh;min-height:200px;"
          (change)="updateStorageMeta($event.target.value)"
        >{{ storage.metadata | json }}</textArea>
      </div>
    </div>

    <br />

    <!-- Removed 8/16/21 to prevent revealing sensitive info
      <div>
        <strong>Your local storage</strong>
        <textarea wrap="off" style="width:100%;height:25vh;min-height:200px;" disabled
        >{{ storage | json }}</textArea>
      </div>
    -->

    <div class="flex-wrap child-margin-xxs flex-center child-flex-1">
      <button *ngIf="storage.privateKey || storage.key || storage.saveKeyLocally"
        type="button" (click)="deleteLocalStorage()"
        class="hover-bg-positive active-bg-balanced bg-black text-white"
      >🗑 clear localStorage</button>

      <button *ngIf="storage.key" type="button" (click)="editChange.emit(edit = !edit)"
        class="bg-grey text-white hover-bg-positive active-bg-balanced"
      >❌ CLOSE</button>

      <!-- saves on changes
        <button type="submit" class="bg-balanced hover-bg-positive active-bg-energized">💾 save</button>
      -->
    </div>
  </form>
</ng-template>

<!-- 💠 -->
<ng-template #privateKeyChange>
  <key-changer [keys]="storage.privateKeys" [(value)]="storage.privateKey"
    (valueChange) = "tempPrivateKey=$event;save()"
  ></key-changer>
</ng-template>
