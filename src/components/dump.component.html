<!-- IF 1: undefined -->
<ng-container *ngIf="'undefined' === typing;else simpleTemplate">
  <ng-container *ngIf="showKids">
    <ng-container *ngTemplateOutlet="dumpSimple;context:{key:key, value:typing}"></ng-container>
  </ng-container>
</ng-container>

<ng-template #simpleTemplate>
  <!-- IF 2: simple value -->
  <ng-container *ngIf="['boolean','number','string'].includes(typing); else objectTemplate">
    <ng-container *ngTemplateOutlet="dumpSimple;context:{key:key, value:value}"></ng-container>
  </ng-container>
</ng-template>

<ng-template #objectTemplate>
  <!-- IF 3: object value -->
  <ng-container [ngSwitch]="value">
    <!--null-->
    <ng-container *ngSwitchCase="null">
      <ng-container *ngIf="showKids">
        <ng-container *ngTemplateOutlet="dumpSimple;context:{key: key, value:'null'}"></ng-container>
      </ng-container>
    </ng-container>

    <ng-container *ngSwitchDefault>
      <!-- array -->
      <ng-container *ngIf="value.push && value.pop;else dumpObject">
        <div *ngIf="value.length" class="border border-radius-5 bg-danger flex-stacked text-dark">
          <a *ngIf="key" class="text-white text-xxs border-white pad-xxs bg-grey-2x flex-1 flex-valign-center flex-apart bg-assertive"
            [class.border-bottom] = "show"
            (click)="show = !show"
          >
            <span class="strong">{{key}}</span>
            <span class="text-xs pad-left-xs">{{value.length}}</span>
          </a>
          <div *ngIf="show || showKids || (show==undefined && showLevels > 0)" class="flex-wrap child-margin-xxs">
            <ng-container *ngFor="let item of value">
              <dump [value]="item" [showLevels]="showLevels" [showKids]="showKids"></dump>
            </ng-container>
          </div>
        </div>
      </ng-container>

      <!-- object -->
      <ng-template #dumpObject>
        <div class="border border-radius-5 bg-info flex-stacked text-sm text-dark">
          <a *ngIf="key" class="text-white strong text-xxs border-white pad-xxs bg-positive flex-1 flex-valign-center"
            [class.border-bottom] = "show"
            (click)="show = !show"
          >{{key}}</a>
          <div *ngIf="!key || showKids || show || (show==undefined && showLevels > 0)" class="flex-wrap">
            <ng-container *ngFor="let item of value | keyvalue : unsorted">
              <dump [value]="item.value" [key]="item.key" [showLevels]="showLevels - 1" [showKids]="showKids"
                class="flex-wrap child-margin-xxs pad-xxs"
              ></dump>
            </ng-container>
          </div>
        </div>
      </ng-template>
    </ng-container>
  </ng-container>
</ng-template>

<ng-template #dumpSimple let-key="key" let-value="value">
  <div class="text-xs text-dark">
    <div *ngIf="key" class="strong text-xxs border-white border-bottom">{{key}}</div>
    <ng-container *ngIf="value.search && (value.slice(0,8)==='https://' || value.slice(0,7)==='http://');else simpleValue">
      <a (click)="copyText(value)" [href]="value" target="_blank" class="hover-bg-warning active-bg-energized">{{value}}</a>
    </ng-container>
    <ng-template #simpleValue>
      <div (click)="copyText(value)" class="cursor-pointer hover-bg-warning active-bg-energized">{{value}}</div>
    </ng-template>
  </div>
</ng-template>